<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>KL Telugu Fellowship Sports Day 2025 Dashboard</title>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <style>
    body { font-family: Arial, sans-serif; margin: 0; background: #f8f6fb; color: #333; }
    header { background: #5e2b97; color: white; padding: 1rem; text-align: center; }
    header img { height: 60px; vertical-align: middle; margin-right: 10px; }
    h1 { margin: 0; font-size: 1.8rem; }
    h2 { color: #5e2b97; margin-top: 2rem; }
    .container { padding: 20px; max-width: 1100px; margin: auto; }
    .card { background: white; border-radius: 12px; box-shadow: 0 4px 8px rgba(0,0,0,0.1); padding: 20px; margin: 15px 0; }
    table { width: 100%; border-collapse: collapse; margin-top: 1rem; }
    th { background: #d4af37; color: white; padding: 10px; text-align: left; }
    td { padding: 10px; border-bottom: 1px solid #ddd; }
    tr:nth-child(even) { background: #f2eafc; }
    tr:hover { background: #f5f5f5; }
    .accordion-toggle { cursor: pointer; font-weight: bold; }
    .accordion-content { display: none; padding-left: 20px; }
    footer { background: #5e2b97; color: white; padding: 1rem; text-align: center; margin-top: 2rem; }
  </style>
</head>
<body>
  <header>
    <img src="kltf-logo.png" alt="Church Logo" />
    <h1>KL Telugu Fellowship - Sports Day 2025 Dashboard</h1>
  </header>
  
  <div class="container">
    <div class="card">
      <h2>Pastoral Team</h2>
      <p><strong>Sr. Pastor:</strong> Rev. James Ravinderan</p>
      <p><strong>Asst. Pastor:</strong> Jerry John</p>
      <p><strong>TF Co-Cordinator:</strong> Aunty Prema</p>
    </div>

    <div class="card">
      <h2>Church Information</h2>
      <p><strong>Address:</strong> 197, Jln Sultan Abdul Samad, Brickfields, 50470 Kuala Lumpur</p>
      <p><strong>Phone:</strong> +6016-985 6777</p>
      <p><strong>Email:</strong> kltelugufellowship@gmail.com</p>
      <p><strong>Sunday Service:</strong> 4:00 PM & 6:00 PM</p>
    </div>

    <div class="card">
      <h2>Sports Participation by Game</h2>
      <table id="sportsTable">
        <thead>
          <tr>
            <th>Sport</th>
            <th>Participants</th>
          </tr>
        </thead>
        <tbody></tbody>
      </table>
    </div>
  </div>

  <footer>
    &copy; 2025 KL Telugu Fellowship - Sports Day
  </footer>

  <script>
    const sheetUrl = "https://script.google.com/macros/s/AKfycbwL20prus-KYONoK7IV50CHc2pfy-tUZQ6ptmZm4Sp2NQmwV4xaJx8N2JDr3EAyj1IF/exec"; // Replace with your deployed Apps Script Web App

    async function fetchData() {
      try {
        const response = await fetch(sheetUrl);
        const data = await response.json();
        renderSportsTable(data);
      } catch (e) {
        console.error("Error fetching data", e);
      }
    }

    function renderSportsTable(data) {
      let sportsMap = {};

      data.forEach(row => {
        let sports = (row["Sports"] || "").split(/[,;]+/).map(s => s.trim());
        sports.forEach(sport => {
          if (!sport) return;
          if (!sportsMap[sport]) sportsMap[sport] = [];
          sportsMap[sport].push(row["Name"]);
        });
      });

      // Sort by participant count
      let sportsArr = Object.entries(sportsMap).sort((a,b) => b[1].length - a[1].length);

      let tbody = document.querySelector("#sportsTable tbody");
      tbody.innerHTML = "";

      sportsArr.forEach(([sport, players]) => {
        let tr = document.createElement("tr");
        tr.classList.add("accordion-toggle");
        tr.innerHTML = `<td>${sport}</td><td>${players.length} (${((players.length/data.length)*100).toFixed(1)}%)</td>`;
        tbody.appendChild(tr);

        let trContent = document.createElement("tr");
        let td = document.createElement("td");
        td.colSpan = 2;
        td.classList.add("accordion-content");
        td.innerHTML = players.join("<br>");
        trContent.appendChild(td);
        tbody.appendChild(trContent);

        tr.addEventListener("click", () => {
          td.style.display = td.style.display === "none" || td.style.display === "" ? "block" : "none";
        });
      });
    }

    fetchData();
    setInterval(fetchData, 60000); // auto-refresh every 60s
  </script>
</body>
</html>
