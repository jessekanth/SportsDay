<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>KL Telugu Fellowship Sports Day 2025 Dashboard</title>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <style>
    body { font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; margin: 0; padding: 0; background: #f4f7fb; color: #333; }
    header { background: linear-gradient(135deg, #4b0082, #6a0dad); color: white; text-align: center; padding: 25px; box-shadow: 0 4px 10px rgba(0,0,0,0.2); }
    header img { height: 90px; margin-bottom: 12px; }
    h1 { margin: 10px 0 5px; font-size: 28px; }
    h2 { margin: 0; font-weight: normal; font-size: 18px; opacity: 0.9; }
    main { padding: 25px; }
    .grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(350px, 1fr)); gap: 25px; }
    .card { background: white; border-radius: 15px; padding: 20px; box-shadow: 0 4px 12px rgba(0,0,0,0.1); transition: transform 0.2s; }
    .card:hover { transform: translateY(-5px); }
    h3 { color: #4b0082; margin-bottom: 12px; }
    table { width: 100%; border-collapse: collapse; margin-top: 10px; }
    table, th, td { border: 1px solid #ddd; }
    th, td { padding: 10px; text-align: left; }
    th { background: #6a0dad; color: white; }
    footer { background: #4b0082; color: white; padding: 20px; margin-top: 30px; font-size: 14px; text-align: center; }
  </style>
</head>
<body>
  <header>
    <img src="kltf-logo.png" alt="KL Telugu Fellowship Logo" />
    <h1>KL Telugu Fellowship</h1>
    <h2>Sports Day 2025 Dashboard</h2>
  </header>

  <main>
    <div class="grid">
      <div class="card">
        <h3>Sports Participation</h3>
        <canvas id="sportsChart"></canvas>
      </div>
      <div class="card">
        <h3>T-Shirt Sizes</h3>
        <canvas id="tshirtChart"></canvas>
      </div>
    </div>

    <div class="card" style="margin-top:20px;">
      <h3>Participant List</h3>
      <table>
        <thead>
          <tr>
            <th>Name</th>
            <th>Sports</th>
            <th>Role</th>
            <th>T-Shirt</th>
          </tr>
        </thead>
        <tbody id="participantTable"></tbody>
      </table>
    </div>

    <div class="card" style="margin-top:20px;">
      <h3>Pastoral Team</h3>
      <p><strong>Sr. Pastor:</strong> Rev. James Ravinderan</p>
      <p><strong>Asst. Pastor:</strong> Jerry John</p>
      <p><strong>TF Co-Cordinator:</strong> Aunty Prema</p>
    </div>

    <div class="card" style="margin-top:20px;">
      <h3>Church Information</h3>
      <p><strong>Address:</strong><br />
      197, Jln Sultan Abdul Samad,<br />
      Brickfields, 50470 Kuala Lumpur</p>
      <p><strong>Phone:</strong> +6016-985 6777</p>
      <p><strong>Email:</strong> kltelugufellowship@gmail.com</p>
      <p><strong>Sunday Service:</strong> 4:00 PM & 6:00 PM</p>
    </div>
  </main>

  <footer>
    Â© 2025 KL Telugu Fellowship - Sports Day Dashboard
  </footer>

  <script>
    async function fetchData() {
      try {
        // Replace with your published Google Sheet CSV link
        const sheetUrl = "https://docs.google.com/spreadsheets/d/YOUR_SHEET_ID/pub?output=csv";
        const response = await fetch(sheetUrl);
        const data = await response.text();

        const rows = data.split("\n").slice(1); // skip header
        const participants = rows.map(r => {
          const cols = r.split(",");
          return { Name: cols[0], Sports: cols[1], Role: cols[2], Tshirt: cols[3] };
        }).filter(p => p.Name);

        renderDashboard(participants);
      } catch (e) {
        console.error("Error fetching Google Sheet data", e);
      }
    }

    function renderDashboard(participants) {
      const sportsCount = {};
      participants.forEach(p => {
        p.Sports.split(";").forEach(sport => {
          const s = sport.trim();
          if (s) sportsCount[s] = (sportsCount[s] || 0) + 1;
        });
      });

      const tshirtCount = {};
      participants.forEach(p => {
        if (p.Tshirt && p.Tshirt !== "Not needed") {
          tshirtCount[p.Tshirt] = (tshirtCount[p.Tshirt] || 0) + 1;
        }
      });

      new Chart(document.getElementById("sportsChart"), {
        type: "pie",
        data: { labels: Object.keys(sportsCount), datasets: [{ data: Object.values(sportsCount), backgroundColor: ["#4b0082", "#6a0dad", "#00C49F", "#FFBB28", "#FF8042"] }] },
      });

      new Chart(document.getElementById("tshirtChart"), {
        type: "bar",
        data: { labels: Object.keys(tshirtCount), datasets: [{ label: "T-Shirts", data: Object.values(tshirtCount), backgroundColor: "#6a0dad" }] },
        options: { responsive: true, scales: { y: { beginAtZero: true } } }
      });

      const tableBody = document.getElementById("participantTable");
      tableBody.innerHTML = "";
      participants.forEach(p => {
        const row = document.createElement("tr");
        row.innerHTML = `<td>${p.Name}</td><td>${p.Sports}</td><td>${p.Role}</td><td>${p.Tshirt}</td>`;
        tableBody.appendChild(row);
      });
    }

    // Auto-refresh every 60 seconds
    fetchData();
    setInterval(fetchData, 60000);
  </script>
</body>
</html>
